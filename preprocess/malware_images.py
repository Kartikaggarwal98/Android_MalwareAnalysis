from  matplotlib import pyplot as plt
import os
import numpy as np
import time
X =[]
y=[]
from PIL import Image
def get_images(folder_path,label):
    apk_folder = os.listdir(folder_path)
    print (folder_path)
    file_list=[]
    for ix in range(500):
            if apk_folder[ix]=='.DS_Store':
                    continue
            file_path = os.path.join(folder_path,apk_folder[ix])
            file_list.append(file_path)
    for ix in range(0,3):
        print ('Processing file ',ix,' ----> ',file_list[ix])
        with open(file_list[ix],'r') as in_file:
            binary_file = np.fromfile(in_file,dtype=np.uint8)
            img_shape = np.ceil(np.sqrt(binary_file.shape[0])).astype(int)
            print (img_shape)
            if img_shape<224:
                img_shape= 224
            img = np.zeros(img_shape**2)
            img[:binary_file.size] = binary_file
            img = img.reshape(img_shape,img_shape)
            img = img[:224,:224]
            print img
            # np.save('./malware_img'+str(ix)+'.npy',img)
            im = Image.fromarray(img)
            if im.mode != 'RGB':
                im = im.convert('RGB')
            im.save('./malware_img/'+str(ix)+'.png')

        # plt.figure(ix/10)
        # plt.subplot(1,10,(ix%10)+1)
        # plt.imshow(img,cmap='gray')
        # plt.axis('off')
    return
get_images('/home/kartik/Desktop/ml/datasets/benign',1)
print (np.array(X).shape, np.array(y).shape)
np.save('./raw_benign_images_X.npy',np.array(X))
np.save('./raw_benign_images_y.npy',np.array(y))